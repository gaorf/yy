<extend name="Public:base"/>
<block name="style">
<script src="__STATICS__lib/ueditor/1.4.3/ueditor.config.js" ></script>
<script src="__STATICS__lib/ueditor/1.4.3/ueditor.all.js" ></script>
<link href="__STATICS__lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__STATICS__lib/webuploader/0.1.5/webuploader.min.js"></script> 
</block>
<block name="container">
<div class="page-container">
	<form action="{:U('addGoods')}" method="post" class="form form-horizontal validate" id="form-article-add">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" name="goods_name" placeholder="" id="" required >
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>生产企业：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text company-name" style="width:25%" value="{$row.company_name}" readonly name="company_name" required >
				<input type="hidden" class="input-text company-id" style="width:5%" value="{$row.company_id}" readonly name="company_id" required >
				<a href="###" class="btn btn-primary select-company">选择企业</a>
				<div class="company-show mt-20  hide">
					<input type="text" class="input-text" style="width:25%" onkeyup="search(this);" placeholder="检索企业"/>
					<div class="company-list mt-10">
						<volist name="Company_list" id="vo">
							<a href="###" class="btn btn-link check-company" data-id="{$vo.id}">{$vo.company_name}</a>
						</volist>
					</div>
				</div>
			</div>	
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>品牌：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text brand-name" style="width:25%" value="" readonly name="brand_name" required >
				<input type="hidden" class="input-text brand-id" style="width:5%" value="" readonly name="brand_id" required >
				<div class="brand-list mt-10 hide"></div>
			</div>	
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>分类：</label>
			<div class="formControls col-xs-8 col-sm-9 link-select">
				<span class="select-box"><select class="select one" name="category_id_1"  onChange="getLinkCategory(this.value,0,'two')" required><option value="">--请选择--</option></select></span>
				<span class="select-box"><select class="select two" name="category_id_2" onChange="getLinkCategory(this.value,0,'three')" required><option value="">--请选择--</option></select></span>
				<span class="select-box"><select class="select three" name="category_id_3" required><option value="">--请选择--</option></select></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>批准文号：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="goods_approval" required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red"></span>库存：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="goods_number" number="true" />
				<span class="c-999">不填写为无限量供货</span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>市场价：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="market_price"  required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>本店价：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="shop_price" required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品规格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="goods_spec" required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>剂型：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="goods_pre" required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>件装数量：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="big_number" required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>中装数量：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" style="width:25%" class="input-text" value="" name="middle_number" required />
				<span class="c-999"></span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">主图：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<webupload />
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商品详情：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<ueditor id="goods_detail" name="goods_detail" value="" />
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">药用说明书：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<ueditor id="goods_specification" name="goods_specification" value="" />
			</div>
		</div>
		<div class="row cl skin-minimal">
			<label class="form-label col-xs-4 col-sm-2">热销：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<div class="switch" data-on="success" data-off="warning" data-animated="false" data-on-label="是" data-off-label="否">
				    <input type="checkbox" name="is_hot" <if condition="!isset($row['is_hot']) OR $row['is_hot'] eq 1">checked</if> value="1" />
				</div>
			</div>
		</div>
		<div class="row cl skin-minimal">
			<label class="form-label col-xs-4 col-sm-2">新品：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<div class="switch" data-on="success" data-off="warning" data-animated="false" data-on-label="是" data-off-label="否">
				    <input type="checkbox" name="is_new" <if condition="!isset($row['is_new']) OR $row['is_new'] eq 1">checked</if> value="1" />
				</div>
			</div>
		</div>
		<div class="row cl skin-minimal">
			<label class="form-label col-xs-4 col-sm-2">状态：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<div class="switch" data-on="success" data-off="warning" data-animated="false" data-on-label="是" data-off-label="否">
				    <input type="checkbox" name="status" <if condition="!isset($row['status']) OR $row['status'] eq 1">checked</if> value="1" />
				</div>
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 提交</button>
			</div>
		</div>
	</form>
</div>	
</block>
<block name="js">
<script>
$(function(){

	$(".validate").validate();
	
	$(".check-company").click(function(){
		var companyId = $(this).data('id');
		var companyName = $(this).text();
		var brandStr = '';
		$(".company-id").val(companyId);
		$(".company-name").val(companyName);
		
		$.get(
			'{:U("Goods/getCompanyBrand")}',
			{company_id:companyId},
			function(data){
				$.each(data,function(i,n){
					brandStr += '<a href="###" class="btn btn-link check-brand" data-id="'+n.id+'">'+n.brand_name+'</a>';
				})
				$(".brand-list").html(brandStr).show();
			},
			'json'
		);
		
		return false;
	});
	
	$(".brand-list").on('click','.check-brand',function(){
		var brandId = $(this).data('id');
		var brandName = $(this).text();
		$(".brand-id").val(brandId);
		$(".brand-name").val(brandName);
		return false;
	});
	
	
	$(".select-company").click(function(){
		if($(".company-show").css("display")=='block'){
			$(".company-show").hide();
			$(".brand-list").hide();
		}else{
			$(".company-show").show();
		}
	});
	
	getLinkCategory(0,0,'one');
});

function getLinkCategory(pid,sid,cla){
	$.get(
		'{:U("Goods/getCategory")}',
		{pid:pid,sid:sid},
		function(data){
			$("."+cla).html('');
			var str = '<option value="">--请选择--</option>';
			$(str+data).appendTo("."+cla);
		},
		'html'
	);	
}

function search(obj){
	var box = $(".company-list");
	var key = $(obj).val();
	$(".company-list a").hide();
	$(".company-list a:contains("+key+")").show();
	
	
}

</script>
</block>